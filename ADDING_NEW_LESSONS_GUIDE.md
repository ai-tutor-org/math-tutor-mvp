# Adding New Lessons - File Organization Reference

Simple reference for where files go when adding new lessons. The system uses registries - no core file modifications needed.

## File Locations

For a new lesson (e.g., "fractions"):

### 1. Content Files (`src/content/`)

```
src/content/
├── lessons.js                           # ADD: New lesson sequence
├── presentations/
│   ├── 07-fractions-intro.js           # NEW: First presentation file
│   ├── 08-fractions-operations.js      # NEW: Additional presentations
│   ├── 09-fractions-practice.js        # NEW: Practice activities
│   ├── 10-fractions-summary.js         # NEW: Lesson summary
│   └── index.js                        # UPDATE: Export new presentations
└── index.js                            # UPDATE: Export new lesson content
```

**Content file example:** `07-fractions-intro.js` contains presentation data and interactions.

### 2. Presentation Components (`src/components/presentations/`)

```
src/components/presentations/
├── 07-fractions/                        # NEW: Lesson-specific folder
│   ├── FractionVisualizer.jsx           # NEW: Main interactive component
│   ├── FractionVisualizer.css           # NEW: Component styles
│   ├── FractionComparison.jsx           # NEW: Additional components
│   ├── FractionComparison.css           # NEW: Component styles
│   ├── FractionPieChart.jsx             # NEW: More components as needed
│   ├── FractionPieChart.css             # NEW: Matching CSS files
│   └── index.js                         # NEW: Export all components
```

**Components:** Each `.jsx` file has a matching `.css` file. Export all in `index.js`.

### 3. UI Interface Components (`src/components/lesson/InteractiveUI/interfaces/`)

```
src/components/lesson/InteractiveUI/interfaces/
├── FractionInputInterface.jsx           # NEW: Fraction input controls
├── FractionComparisonInterface.jsx      # NEW: Fraction comparison UI
└── FractionDragDropInterface.jsx        # NEW: Drag & drop fractions
```

**Interface components:** Handle user input controls (left side of screen).

### 4. Custom Hooks (`src/hooks/`)

```
src/hooks/
├── useFractionInput.js                  # NEW: Fraction input validation
├── useFractionComparison.js             # NEW: Fraction comparison logic
└── useFractionOperations.js             # NEW: Addition/subtraction logic
```

**Custom hooks:** Business logic and state management for lesson interactions.

## Registry Updates Required

### 1. Component Registry (`src/utils/componentRegistry.js`)
- Add imports for presentation and UI interface components
- Map interaction types to components in `componentMap` and `uiInterfaceMap`

### 2. Lesson Registry (`src/lessons/LessonRegistry.js`)
- Add lesson config with hooks, handlers, answerHandlers, animationRules

### 3. Content Index (`src/content/index.js`)
- Export all new presentation files

### 4. Lessons Configuration (`src/content/lessons.js`)
- Add lesson with title and sequence of presentationIds

## Audio System
- TTS content needs `tutorText` and `audioFile` in content files
- Audio auto-generated by `generate_audio.py` → stored in `public/audio/`
- Use `setDynamicTutorText()`, never call `triggerTTS()` manually

## Routing
New lesson automatically available at `/lesson/{lessonId}` once added to `lessons.js`.

## Naming Conventions
- **Components**: `PascalCase.jsx` + matching `.css`
- **Hooks**: `useCamelCase.js` 
- **Content**: `##-kebab-case.js`
- **IDs**: `kebab-case` for presentations, interactions, component types

## Quick Checklist
- [ ] Content files in `src/content/presentations/`
- [ ] Update `src/content/index.js` and `lessons.js` 
- [ ] Components in `src/components/presentations/{lesson}/`
- [ ] UI interfaces in `interfaces/` folder
- [ ] Custom hooks in `src/hooks/`
- [ ] Update `componentRegistry.js` and `LessonRegistry.js`
- [ ] Generate audio with `generate_audio.py`
- [ ] Test with `npm run dev`

**Key Rule:** No core file modifications needed - everything goes through registries.

## Architecture Patterns Explained

### 🏭 **Factory Pattern** (`CoordinatorFactory`)
**Purpose:** Automatically creates the right coordinator for each lesson type.

**How it works:**
```javascript
// When you request a lesson coordinator:
const coordinator = createLessonCoordinator('fractions');
// Factory looks up 'fractions' in registry and returns: new FractionsCoordinator()
```

**For new lessons:** Add your coordinator class to `COORDINATOR_REGISTRY` in `CoordinatorFactory.js`

### 📋 **Registry Pattern** (`LessonRegistry`)
**Purpose:** Configuration file that defines lesson behavior without code changes.

**What to configure:**
```javascript
fractions: {
  hooks: [{ name: 'useFractionInput', key: 'fractionHook' }],
  handlers: { onFractionCheck: {...} },
  answerHandlers: { 'fraction-input': 'handleFractionInput' },
  animationRules: [{ pattern: 'fraction-*', trigger: 'auto' }]
}
```

**Benefits:** Change lesson behavior by editing config, no code modifications needed.

### 🎯 **Coordinator Pattern** (`BaseCoordinator` + Custom Coordinators)
**Purpose:** Each lesson gets its own "brain" to handle lesson-specific logic.

**For new lessons:**
1. Create `src/coordinators/FractionsCoordinator.js`
2. Extend `BaseCoordinator`
3. Implement handlers like `onFractionCheck()`, `handleFractionInput()`

**Example structure:**
```javascript
export class FractionsCoordinator extends BaseCoordinator {
  constructor(config) {
    super('fractions', config);
  }
  
  onFractionCheck({ hook, interaction, context }) {
    // Your fraction validation logic here
  }
}
```

### 🎣 **Hook Manager Pattern** (`LessonHookManager`)
**Purpose:** Dynamically loads React hooks based on lesson requirements.

**How it works:**
- All hooks are imported at top level (React compliant)
- Configuration maps which hooks each lesson needs
- Manager provides only the hooks specified in lesson config

**For new lessons:** Add your hooks to `HOOK_MAP` in `LessonHookManager.js`

### 🗂️ **Component Registry Pattern** (`componentRegistry.js`)
**Purpose:** Maps interaction types to React components automatically.

**Two registries:**
1. **componentMap:** Right-side content (games, visualizations, etc.)
2. **uiInterfaceMap:** Left-side controls (inputs, buttons, etc.)

**For new lessons:** Add your components to appropriate registry with hook/handler mappings.

### 🛡️ **Error Boundary Pattern** (`LessonErrorBoundary`)
**Purpose:** Prevents crashes by catching errors and showing user-friendly fallbacks.

**Benefits:**
- User never sees "white screen of death"
- Provides retry functionality
- Shows helpful error info in development

### 🔧 **Debug Tools Pattern** (`LessonDebugger`)
**Purpose:** Development tools for testing and debugging lessons.

**Available in browser console:**
```javascript
// Test specific handlers
window.lessonDebug.testHandler('onFractionCheck', testData);

// Inspect current interaction
window.lessonDebug.inspectInteraction(interaction);

// View coordinator info
window.lessonDebug.getCoordinatorInfo();
```

### 🎮 **UI Controller Pattern** (`InteractiveUI`)
**Purpose:** Smart component that automatically shows correct UI elements.

**How it works:**
- Looks up interaction type in registry
- Loads appropriate interface component
- Maps hooks and handlers automatically
- Shows/hides based on lesson state

## 🔄 **How Everything Connects**

**When a lesson runs:**

1. **Factory** creates appropriate coordinator based on lesson ID
2. **Registry** provides configuration for that lesson type  
3. **Hook Manager** loads required hooks from config
4. **Component Registry** maps interactions to UI components
5. **Coordinator** handles all lesson-specific business logic
6. **UI Controller** shows correct interfaces at right times
7. **Error Boundary** catches any problems gracefully
8. **Debug Tools** help during development

## 🎯 **Key Benefits of This Architecture**

### **Modularity**
- Each pattern has a single, clear responsibility
- Components are independent and testable
- Changes are localized to specific files

### **Configurability** 
- Lesson behavior driven by data, not code
- Modify lessons without touching core logic
- Easy to experiment with different approaches

### **Extensibility**
- New lessons = new config + new coordinator
- Existing patterns handle new lesson types automatically
- No modifications to `InteractiveLesson.jsx` needed

### **Maintainability**
- Clear separation of concerns
- Predictable file organization
- Self-documenting through configuration

### **Developer Experience**
- Debug tools for troubleshooting
- Error boundaries prevent crashes
- Registry patterns make relationships clear

**This architecture enables rapid lesson development while maintaining code quality and system stability.**